// Конфигурация категорий и их порядок отображения
const categoryConfig = [
    { id: 'home', name: 'Home & Kitchen', displayOrder: 1 },
    { id: 'beauty', name: 'Beauty & Care', displayOrder: 2 },
    { id: 'tech', name: 'Electronics', displayOrder: 3 },
    { id: 'furniture', name: 'Furniture', displayOrder: 4 }
];

let currentFilter = 'all';
let currentSearch = '';

// Функция группировки товаров по категориям
function groupProductsByCategory() {
    const productGrid = document.querySelector('.product-grid');
    const products = Array.from(document.querySelectorAll('.product-card'));
    const noResults = document.getElementById('noResults');
    
    // Сохраняем noResults и очищаем сетку
    productGrid.innerHTML = '';
    productGrid.appendChild(noResults);
    
    // Сортируем категории по порядку отображения
    const sortedCategories = [...categoryConfig].sort((a, b) => a.displayOrder - b.displayOrder);
    
    // Группируем товары по категориям
    const productsByCategory = {};
    sortedCategories.forEach(category => {
        productsByCategory[category.id] = [];
    });
    
    // Распределяем товары по категориям (берем первую категорию из data-category)
    products.forEach(product => {
        const productCategories = product.getAttribute('data-category').split(' ');
        const mainCategory = productCategories[0]; // берем первую категорию как основную
        
        if (productsByCategory[mainCategory]) {
            productsByCategory[mainCategory].push(product);
        }
    });
    
    // Создаем DOM-структуру с категориями
    sortedCategories.forEach(category => {
        const categoryProducts = productsByCategory[category.id];
        
        if (categoryProducts.length > 0) {
            // Создаем заголовок категории
            const categoryHeader = document.createElement('div');
            categoryHeader.className = 'category-header';
            categoryHeader.innerHTML = `<h2>${category.name}</h2>`;
            categoryHeader.setAttribute('data-category', category.id);
            productGrid.appendChild(categoryHeader);
            
            // Добавляем товары категории
            categoryProducts.forEach(product => {
                productGrid.appendChild(product);
            });
        }
    });
}

// Функция фильтрации товаров
function filterProducts(category) {
    currentFilter = category;
    applyFilters();
    
    // Обновляем активную кнопку
    const buttons = document.querySelectorAll('.filter-btn');
    buttons.forEach(btn => btn.classList.remove('active'));
    event.currentTarget.classList.add('active');
}

// Функция поиска товаров
function searchProducts() {
    currentSearch = document.querySelector('.search-box').value.toLowerCase();
    applyFilters();
}

// Применяем оба фильтра (по категории и поиску)
function applyFilters() {
    const products = document.querySelectorAll('.product-card');
    const categoryHeaders = document.querySelectorAll('.category-header');
    let visibleCount = 0;
    const visibleCategories = new Set();

    // Сначала скрываем все
    products.forEach(product => product.style.display = 'none');
    categoryHeaders.forEach(header => header.style.display = 'none');

    // Применяем фильтры к товарам
    products.forEach(product => {
        const categoryMatch = currentFilter === 'all' || 
                            product.getAttribute('data-category').includes(currentFilter);
        const searchMatch = product.getAttribute('data-title').includes(currentSearch) || 
                          currentSearch === '';

        if (categoryMatch && searchMatch) {
            product.style.display = 'block';
            visibleCount++;
            
            // Определяем основную категорию товара для показа заголовка
            const productCategories = product.getAttribute('data-category').split(' ');
            const mainCategory = productCategories[0];
            visibleCategories.add(mainCategory);
        }
    });

    // Показываем заголовки категорий, у которых есть видимые товары
    categoryHeaders.forEach(header => {
        const headerCategory = header.getAttribute('data-category');
        if (visibleCategories.has(headerCategory)) {
            header.style.display = 'block';
        }
    });

    // Показываем/скрываем сообщение "нет результатов"
    document.getElementById('noResults').style.display = visibleCount === 0 ? 'block' : 'none';
}

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    groupProductsByCategory();
    applyFilters(); // Применяем фильтры чтобы показать все товары изначально
});
